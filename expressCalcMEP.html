<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–≠–∫—Å–ø—Ä–µ—Å—Å-—Ä–∞—Å—á–µ—Ç –ù–∞–≥—Ä—É–∑–æ–∫ –ù–ò–°</title>
    <style>
      :root {
        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
        --bg-primary: #f5f5f5;
        --bg-secondary: #ffffff;
        --bg-tertiary: #f8f9fa;
        --text-primary: #333333;
        --text-secondary: #34495e;
        --text-muted: #7f8c8d;
        --border-color: #ddd;
        --shadow-light: rgba(0, 0, 0, 0.1);
        --shadow-medium: rgba(0, 0, 0, 0.15);
        --accent-primary: #3498db;
        --accent-secondary: #2980b9;
        --accent-success: #1f874a;
        --accent-success-hover: #219a52;
        --accent-warning: #f39c12;
        --accent-error: #e74c3c;
        --info-bg: #fff3cd;
        --info-border: #ffeaa7;
        --info-text: #856404;
        --info-separator: #f1c40f;
        --input-focus: #3498db;
        --input-error-bg: #fdf2f2;
        --input-warning-bg: #fef9e7;
        --validation-error-bg: #fdf2f2;
        --validation-error-border: #e74c3c;
        --validation-warning-bg: #fef9e7;
        --validation-warning-border: #f39c12;
        --disabled-bg: #bdc3c7;
        --hover-bg: #f8f9fa;
        --separator-color: #ecf0f1;
        --table-border: #f8f9fa;
      }

      /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
      @media (prefers-color-scheme: dark) {
        :root {
          --bg-primary: #1a1a1a;
          --bg-secondary: #2d2d2d;
          --bg-tertiary: #3a3a3a;
          --text-primary: #e0e0e0;
          --text-secondary: #b0b0b0;
          --text-muted: #888888;
          --border-color: #555555;
          --shadow-light: rgba(0, 0, 0, 0.3);
          --shadow-medium: rgba(0, 0, 0, 0.4);
          --accent-primary: #3776bd;
          --accent-secondary: #357abd;
          --accent-success: #186b3b;
          --accent-success-hover: #1f8b4c;
          --accent-warning: #f39c12;
          --accent-error: #e74c3c;
          --info-bg: #3a3a2a;
          --info-border: #4a4a3a;
          --info-text: #d4af37;
          --info-separator: #5a5a4a;
          --input-focus: #4a9eff;
          --input-error-bg: #4a2a2a;
          --input-warning-bg: #4a3a2a;
          --validation-error-bg: #4a2a2a;
          --validation-error-border: #e74c3c;
          --validation-warning-bg: #4a3a2a;
          --validation-warning-border: #f39c12;
          --disabled-bg: #555555;
          --hover-bg: #404040;
          --separator-color: #555555;
          --table-border: #404040;
        }
      }

      /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–µ–º—ã —á–µ—Ä–µ–∑ data-theme */
      [data-theme="light"] {
        --bg-primary: #f5f5f5;
        --bg-secondary: #ffffff;
        --bg-tertiary: #f8f9fa;
        --text-primary: #333333;
        --text-secondary: #34495e;
        --text-muted: #7f8c8d;
        --border-color: #ddd;
        --shadow-light: rgba(0, 0, 0, 0.1);
        --shadow-medium: rgba(0, 0, 0, 0.15);
        --accent-primary: #3498db;
        --accent-secondary: #2980b9;
        --accent-success: #27ae60;
        --accent-success-hover: #219a52;
        --accent-warning: #f39c12;
        --accent-error: #e74c3c;
        --info-bg: #fff3cd;
        --info-border: #ffeaa7;
        --info-text: #856404;
        --info-separator: #f1c40f;
        --input-focus: #3498db;
        --input-error-bg: #fdf2f2;
        --input-warning-bg: #fef9e7;
        --validation-error-bg: #fdf2f2;
        --validation-error-border: #e74c3c;
        --validation-warning-bg: #fef9e7;
        --validation-warning-border: #f39c12;
        --disabled-bg: #bdc3c7;
        --hover-bg: #f8f9fa;
        --separator-color: #ecf0f1;
        --table-border: #f8f9fa;
      }

      [data-theme="dark"] {
        --bg-primary: #1a1a1a;
        --bg-secondary: #2d2d2d;
        --bg-tertiary: #3a3a3a;
        --text-primary: #e0e0e0;
        --text-secondary: #b0b0b0;
        --text-muted: #888888;
        --border-color: #555555;
        --shadow-light: rgba(0, 0, 0, 0.3);
        --shadow-medium: rgba(0, 0, 0, 0.4);
        --accent-primary: #3a7dca;
        --accent-secondary: #357abd;
        --accent-success: #259755;
        --accent-success-hover: #1d944f;
        --accent-warning: #f39c12;
        --accent-error: #e74c3c;
        --info-bg: #3a3a2a;
        --info-border: #4a4a3a;
        --info-text: #d4af37;
        --info-separator: #5a5a4a;
        --input-focus: #3d82d0;
        --input-error-bg: #4a2a2a;
        --input-warning-bg: #4a3a2a;
        --validation-error-bg: #4a2a2a;
        --validation-error-border: #e74c3c;
        --validation-warning-bg: #4a3a2a;
        --validation-warning-border: #f39c12;
        --disabled-bg: #555555;
        --hover-bg: #404040;
        --separator-color: #555555;
        --table-border: #404040;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: var(--text-primary);
        background-color: var(--bg-primary);
        padding: 20px;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: var(--bg-secondary);
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 6px var(--shadow-light);
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 20px;
      }

      h1 {
        color: var(--text-primary);
        font-size: 2.2em;
        flex: 1;
        text-align: center;
      }

      .theme-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
        background: var(--bg-tertiary);
        padding: 8px 12px;
        border-radius: 25px;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
      }

      .theme-toggle:hover {
        background: var(--hover-bg);
      }

      .theme-toggle-switch {
        position: relative;
        width: 50px;
        height: 26px;
        background: var(--border-color);
        border-radius: 13px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .theme-toggle-switch::before {
        content: "";
        position: absolute;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: var(--bg-secondary);
        top: 2px;
        left: 2px;
        transition: transform 0.3s ease;
        box-shadow: 0 2px 4px var(--shadow-light);
      }

      .theme-toggle-switch.active {
        background: var(--accent-primary);
      }

      .theme-toggle-switch.active::before {
        transform: translateX(24px);
      }

      .theme-icon {
        font-size: 16px;
        color: var(--text-muted);
      }

      .form-section {
        margin-bottom: 25px;
        padding: 20px;
        background-color: var(--bg-tertiary);
        border-radius: 8px;
        border-left: 4px solid var(--accent-primary);
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      .form-section h2 {
        color: var(--text-primary);
        margin-bottom: 15px;
        font-size: 1.3em;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      label {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--text-secondary);
      }

      input,
      select {
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        font-size: 14px;
        transition: border-color 0.3s ease, background-color 0.3s ease,
          color 0.3s ease;
        background-color: var(--bg-secondary);
        color: var(--text-primary);
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--input-focus);
      }

      .input-error {
        border-color: var(--accent-error) !important;
        background-color: var(--input-error-bg);
      }

      .input-warning {
        border-color: var(--accent-warning) !important;
        background-color: var(--input-warning-bg);
      }

      .validation-message {
        font-size: 12px;
        margin-top: 5px;
        padding: 5px;
        border-radius: 3px;
      }

      .validation-error {
        color: var(--accent-error);
        background-color: var(--validation-error-bg);
        border: 1px solid var(--validation-error-border);
      }

      .validation-warning {
        color: var(--accent-warning);
        background-color: var(--validation-warning-bg);
        border: 1px solid var(--validation-warning-border);
      }

      .calculate-btn {
        background-color: var(--accent-primary);
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        margin: 20px auto;
        display: block;
        transition: background-color 0.3s ease;
      }

      .calculate-btn:hover {
        background-color: var(--accent-secondary);
      }

      .calculate-btn:disabled {
        background-color: var(--disabled-bg);
        cursor: not-allowed;
      }

      .results {
        margin-top: 30px;
        display: none;
      }

      .info-messages {
        margin-top: 20px;
        padding: 15px;
        background-color: var(--info-bg);
        border: 1px solid var(--info-border);
        border-radius: 5px;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      .info-messages h3 {
        color: var(--info-text);
        margin-bottom: 10px;
      }

      .info-messages ul {
        list-style-type: none;
        padding: 0;
      }

      .info-messages li {
        padding: 8px 0;
        border-bottom: 1px solid var(--info-separator);
        line-height: 1.4;
        color: var(--text-primary);
      }

      .info-messages li:last-child {
        border-bottom: none;
      }

      .insufficient-data {
        color: var(--accent-warning);
        font-style: italic;
      }

      .rso-section {
        margin-bottom: 30px;
        background: var(--bg-secondary);
        border-radius: 8px;
        box-shadow: 0 2px 4px var(--shadow-light);
        overflow: hidden;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }

      .rso-header {
        background-color: var(--accent-primary);
        color: white;
        padding: 15px 20px;
        font-size: 1.2em;
        font-weight: 600;
        margin: 0;
      }

      .rso-content {
        padding: 20px;
      }

      .system-group {
        margin-bottom: 20px;
      }

      .system-group:last-child {
        margin-bottom: 0;
      }

      .system-title {
        font-size: 1.1em;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 2px solid var(--separator-color);
      }

      .parameter-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid var(--table-border);
      }

      .parameter-item:last-child {
        border-bottom: none;
      }

      .parameter-name {
        font-weight: 500;
        color: var(--text-secondary);
      }

      .parameter-value {
        font-weight: 600;
        color: var(--text-primary);
      }

      .parameter-unit {
        font-size: 0.9em;
        color: var(--text-muted);
        margin-left: 5px;
      }

      .auto-fill-btn {
        background-color: var(--accent-success);
        color: white;
        padding: 8px 15px;
        border: none;
        border-radius: 5px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .auto-fill-btn:hover {
        background-color: var(--accent-success-hover);
      }

      .footer {
        margin-top: 40px;
        padding: 20px;
        background-color: var(--bg-tertiary);
        border-radius: 8px;
        border-top: 3px solid var(--accent-primary);
        text-align: center;
        color: var(--text-muted);
        font-size: 0.9em;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      .footer-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .author-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .author-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--accent-primary),
          var(--accent-secondary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 14px;
      }

      .version-info {
        font-size: 0.8em;
        opacity: 0.8;
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          text-align: center;
        }

        h1 {
          font-size: 1.8em;
        }

        .parameter-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 5px;
        }

        .container {
          padding: 15px;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .footer-content {
          flex-direction: column;
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>–≠–∫—Å–ø—Ä–µ—Å—Å-—Ä–∞—Å—á–µ—Ç –Ω–∞–≥—Ä—É–∑–æ–∫ –ù–ò–°</h1>
        <div class="theme-toggle">
          <span class="theme-icon">‚òÄÔ∏è</span>
          <div class="theme-toggle-switch" id="themeToggle"></div>
          <span class="theme-icon">üåô</span>
        </div>
      </div>

      <form id="calculationForm">
        <div class="form-section">
          <h2>–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="totalArea">–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –∑–¥–∞–Ω–∏—è (–º¬≤):</label>
              <input type="number" id="totalArea" min="0" step="0.01" />
              <div
                id="totalArea-validation"
                class="validation-message"
                style="display: none"
              ></div>
            </div>
            <div class="form-group">
              <label for="residentialArea">–ñ–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å (–º¬≤):</label>
              <input type="number" id="residentialArea" min="0" step="0.01" />
              <div
                id="residentialArea-validation"
                class="validation-message"
                style="display: none"
              ></div>
            </div>
            <div class="form-group">
              <label for="landArea">–ü–ª–æ—â–∞–¥—å –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ (–º¬≤):</label>
              <input type="number" id="landArea" min="0" step="0.01" />
              <div
                id="landArea-validation"
                class="validation-message"
                style="display: none"
              ></div>
            </div>
            <div class="form-group">
              <label for="objectClass">–ö–ª–∞—Å—Å –æ–±—ä–µ–∫—Ç–∞:</label>
              <select id="objectClass">
                <option value="–°—Ç–∞–Ω–¥–∞—Ä—Ç">–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                <option value="–ë–∏–∑–Ω–µ—Å/–ü—Ä–µ–º–∏—É–º">–ë–∏–∑–Ω–µ—Å/–ü—Ä–µ–º–∏—É–º</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h2>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="floorCount">–≠—Ç–∞–∂–Ω–æ—Å—Ç—å –∑–¥–∞–Ω–∏—è:</label>
              <input type="number" id="floorCount" min="1" max="50" step="1" />
              <div
                id="floorCount-validation"
                class="validation-message"
                style="display: none"
              ></div>
            </div>
            <div class="form-group">
              <label for="unitCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä:</label>
              <input type="number" id="unitCount" min="0" step="1" />
              <div
                id="unitCount-validation"
                class="validation-message"
                style="display: none"
              ></div>
            </div>
            <div class="form-group">
              <label for="hasGas">–¢–∏–ø –ø–ª–∏—Ç:</label>
              <select id="hasGas">
                <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
                <option value="true">–ì–∞–∑–æ–≤—ã–µ</option>
                <option value="false">–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ</option>
              </select>
            </div>
            <div class="form-group">
              <label for="hasParking">–ù–∞–ª–∏—á–∏–µ –ø–∞—Ä–∫–∏–Ω–≥–∞:</label>
              <select id="hasParking">
                <option value="false">–ù–µ—Ç</option>
                <option value="true">–ï—Å—Ç—å</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h2>–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="roofArea">–ü–ª–æ—â–∞–¥—å –∫—Ä–æ–≤–ª–∏ (–º¬≤):</label>
              <input type="number" id="roofArea" min="0" step="0.01" />
              <div
                id="roofArea-validation"
                class="validation-message"
                style="display: none"
              ></div>
            </div>
            <div class="form-group">
              <label for="lawnArea">–ü–ª–æ—â–∞–¥—å –≥–∞–∑–æ–Ω–æ–≤ (–º¬≤):</label>
              <input type="number" id="lawnArea" min="0" step="0.01" />
              <div
                id="lawnArea-validation"
                class="validation-message"
                style="display: none"
              ></div>
            </div>
            <div class="form-group">
              <label for="hardscapeArea">–ü–ª–æ—â–∞–¥—å —Ç–≤–µ—Ä–¥—ã—Ö –ø–æ–∫—Ä—ã—Ç–∏–π (–º¬≤):</label>
              <input type="number" id="hardscapeArea" min="0" step="0.01" />
              <div
                id="hardscapeArea-validation"
                class="validation-message"
                style="display: none"
              ></div>
            </div>
            <div class="form-group">
              <label for="autoFillTerrain">–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ:</label>
              <button type="button" id="autoFillTerrain" class="auto-fill-btn">
                –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–æ –Ω–æ—Ä–º–∞—Ç–∏–≤–∞–º
              </button>
            </div>
          </div>
        </div>

        <button type="submit" class="calculate-btn" id="calculateBtn">
          –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
        </button>
      </form>

      <div id="results" class="results">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>
        <div id="resultsContainer"></div>

        <div id="infoMessages" class="info-messages">
          <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
          <ul id="messagesList"></ul>
        </div>
      </div>

      <div class="footer">
        <div class="footer-content">
          <div class="author-info">
            <div class="author-avatar">–†–ò</div>
            <div>
              <strong>–ê–≤—Ç–æ—Ä:</strong> –†–æ–º–∞—à–æ–≤ –ò.–°.<br />
              <span class="version-info">–ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞</span>
            </div>
          </div>
          <div class="version-info">
            –í–µ—Ä—Å–∏—è alpha 0.1 ‚Ä¢ 2025<br />
            –≠–∫—Å–ø—Ä–µ—Å—Å-—Ä–∞—Å—á–µ—Ç –Ω–∞–≥—Ä—É–∑–æ–∫ –ù–ò–°
          </div>
        </div>
      </div>
    </div>

    <script>
      // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
      const CONSTANTS = {
        DEFAULT_RESIDENTIAL_RATIO: 0.75, // –ö–æ—ç—Ñ—Ñ. –∂–∏–ª–æ–π –ø–ª–æ—â–∞–¥–∏ –æ—Ç –æ–±—â–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        // –≠–ª–µ–∫—Ç—Ä–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ
        ELEC_LOAD_FACTOR_STD: 0.055,
        ELEC_LOAD_FACTOR_PREMIUM: 0.075,
        ELEC_LOAD_FACTOR_RESIDENTIAL_STD: 0.065,
        ELEC_LOAD_FACTOR_RESIDENTIAL_PREMIUM: 0.085,
        ELEC_LOAD_PARKING: 0.02,
        ELEC_THRESHOLD_10KV: 670,
        ELEC_COOKING_MULTIPLIER: 1.15,

        // –ù–æ—Ä–º–∞—Ç–∏–≤—ã –¥–ª—è –∫–≤–∞—Ä—Ç–∏—Ä
        STANDARD_APARTMENT_AREA: 65, // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –°–ü
        LARGE_APARTMENT_THRESHOLD: 80, // –ü–æ—Ä–æ–≥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–≤–∞—Ä—Ç–∏—Ä

        // –ù–æ—Ä–º–∞—Ç–∏–≤—ã –¥–ª—è –ø–∞—Ä–∫–∏–Ω–≥–∞
        NORM_SPACES_PER_UNIT_STD: 1.2, // –ù–æ—Ä–º–∞—Ç–∏–≤ –º–∞—à–∏–Ω–æ–º–µ—Å—Ç–∞ –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É
        NORM_SPACES_PER_UNIT_PREMIUM: 2.2, // –ù–æ—Ä–º–∞—Ç–∏–≤ –¥–ª—è –ø—Ä–µ–º–∏—É–º-–∫–ª–∞—Å—Å–∞
        NORM_AREA_PER_SPACE: 30, // –ü–ª–æ—â–∞–¥—å –Ω–∞ 1 –º/–º

        // –¢–µ–ø–ª–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ
        HEAT_LOAD_FACTOR_STD: 110,
        HEAT_LOAD_FACTOR_PREMIUM: 120,
        KW_TO_GCAL_H_FACTOR: 0.00086,

        // –í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ
        AREA_PER_PERSON_STD: 33,
        WATER_NORM_DAY: 180,
        WATER_NORM_HOUR: 10.5,
        WATER_NORM_SECOND_Q0: 0.2,
        WATER_ALPHA_COEFF: 1.2,

        // –î–æ–∂–¥–µ–≤–∞—è –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è
        COEFF_ROOF: 0.95,
        COEFF_ASPHALT: 0.85,
        COEFF_LAWN: 0.35,
        Q20_MOSCOW: 80,
        STORM_PARAM_N_MOSCOW: 0.71,

        // –ù–æ—Ä–º–∞—Ç–∏–≤—ã
        MAX_AREA_RATIO: 0.85,
        MIN_AREA_RATIO: 0.45,
        MAX_FLOOR_COUNT: 50,
        MIN_FLOOR_COUNT: 1,
        TYPICAL_APARTMENT_AREA: 65,

        // –ù–æ—Ä–º–∞—Ç–∏–≤—ã –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        NORM_LAWN_RATIO: 0.25,
        NORM_HARDSCAPE_RATIO: 0.35,
        NORM_BUILDING_RATIO: 0.2,
      };

      // Lookup —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–∞–≥—Ä—É–∑–æ–∫ (–°–ü 256.1325800.2016)
      const ELEC_LOAD_TABLE = {
        gas: {
          1: 5.0,
          2: 4.6,
          3: 4.3,
          4: 4.1,
          5: 3.9,
          6: 3.8,
          7: 3.7,
          8: 3.6,
          9: 3.5,
          10: 3.4,
          15: 3.2,
          20: 3.0,
          25: 2.9,
          30: 2.8,
          40: 2.7,
          50: 2.6,
          60: 2.5,
          70: 2.4,
          80: 2.3,
          90: 2.2,
          100: 2.1,
          120: 2.0,
          150: 1.9,
          200: 1.8,
          300: 1.7,
          400: 1.6,
          500: 1.5,
          600: 1.4,
          700: 1.3,
          800: 1.2,
          900: 1.1,
          1000: 1.0,
        },
        electric: {
          1: 8.5,
          2: 7.8,
          3: 7.3,
          4: 6.9,
          5: 6.6,
          6: 6.4,
          7: 6.2,
          8: 6.0,
          9: 5.8,
          10: 5.7,
          15: 5.3,
          20: 5.0,
          25: 4.8,
          30: 4.6,
          40: 4.4,
          50: 4.2,
          60: 4.1,
          70: 4.0,
          80: 3.9,
          90: 3.8,
          100: 3.7,
          120: 3.6,
          150: 3.5,
          200: 3.4,
          300: 3.3,
          400: 3.2,
          500: 3.1,
          600: 3.0,
          700: 2.9,
          800: 2.8,
          900: 2.7,
          1000: 2.6,
        },
      };

      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–æ–π
      class ThemeManager {
        constructor() {
          this.themeToggle = document.getElementById("themeToggle");
          this.currentTheme = this.getStoredTheme() || this.getSystemTheme();
          this.init();
        }

        init() {
          this.setTheme(this.currentTheme);
          this.themeToggle.addEventListener("click", () => this.toggleTheme());
        }

        getSystemTheme() {
          return window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light";
        }

        getStoredTheme() {
          return localStorage.getItem("theme");
        }

        setTheme(theme) {
          this.currentTheme = theme;
          document.documentElement.setAttribute("data-theme", theme);
          localStorage.setItem("theme", theme);
          this.updateToggleAppearance();
        }

        toggleTheme() {
          const newTheme = this.currentTheme === "light" ? "dark" : "light";
          this.setTheme(newTheme);
        }

        updateToggleAppearance() {
          if (this.currentTheme === "dark") {
            this.themeToggle.classList.add("active");
          } else {
            this.themeToggle.classList.remove("active");
          }
        }
      }

      // –ö–ª–∞—Å—Å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
      class DataValidator {
        constructor() {
          this.validationRules = new Map();
          this.setupValidationRules();
        }

        setupValidationRules() {
          this.validationRules.set("totalArea", {
            min: 50,
            max: 100000,
            warningMax: 50000,
            required: false,
          });

          this.validationRules.set("residentialArea", {
            min: 30,
            max: 85000,
            warningMax: 40000,
            required: false,
          });

          this.validationRules.set("landArea", {
            min: 100,
            max: 500000,
            warningMax: 100000,
            required: false,
          });

          this.validationRules.set("floorCount", {
            min: 1,
            max: 50,
            warningMax: 25,
            required: false,
          });

          this.validationRules.set("unitCount", {
            min: 1,
            max: 1000,
            warningMax: 500,
            required: false,
          });
        }

        validateField(fieldId, value) {
          const rule = this.validationRules.get(fieldId);
          if (!rule) return { valid: true };

          const numValue = parseFloat(value);

          if (value === "" || value === null || value === undefined) {
            if (rule.required) {
              return {
                valid: false,
                type: "error",
                message: "–ü–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è",
              };
            }
            return { valid: true };
          }

          if (isNaN(numValue)) {
            return {
              valid: false,
              type: "error",
              message: "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ",
            };
          }

          if (numValue < rule.min) {
            return {
              valid: false,
              type: "error",
              message: `–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${rule.min}`,
            };
          }

          if (numValue > rule.max) {
            return {
              valid: false,
              type: "error",
              message: `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${rule.max}`,
            };
          }

          if (rule.warningMax && numValue > rule.warningMax) {
            return {
              valid: true,
              type: "warning",
              message: `–ë–æ–ª—å—à–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å.`,
            };
          }

          return { valid: true };
        }

        validateRelationships(data) {
          const errors = [];
          const warnings = [];

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –∂–∏–ª–∞—è/–æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å
          if (data.totalArea > 0 && data.residentialArea > 0) {
            const ratio = data.residentialArea / data.totalArea;
            if (ratio > CONSTANTS.MAX_AREA_RATIO) {
              errors.push(
                "–ñ–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 85% –æ—Ç –æ–±—â–µ–π –ø–ª–æ—â–∞–¥–∏"
              );
            } else if (ratio < CONSTANTS.MIN_AREA_RATIO) {
              warnings.push(
                "–ñ–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å –º–µ–Ω–µ–µ 45% –æ—Ç –æ–±—â–µ–π - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å"
              );
            }
          }

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç—Ç–∞–∂–Ω–æ—Å—Ç–∏ –∏ –ø–ª–æ—â–∞–¥–∏
          if (data.floorCount > 0 && data.totalArea > 0) {
            const floorArea = data.totalArea / data.floorCount;
            if (floorArea < 100) {
              warnings.push(
                "–û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∞—è –ø–ª–æ—â–∞–¥—å —ç—Ç–∞–∂–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç—Ç–∞–∂–Ω–æ—Å—Ç—å."
              );
            } else if (floorArea > 3000) {
              warnings.push(
                "–û—á–µ–Ω—å –±–æ–ª—å—à–∞—è –ø–ª–æ—â–∞–¥—å —ç—Ç–∞–∂–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç—Ç–∞–∂–Ω–æ—Å—Ç—å."
              );
            }
          }

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–≤–∞—Ä—Ç–∏—Ä
          if (data.unitCount > 0 && data.residentialArea > 0) {
            const avgApartmentArea = data.residentialArea / data.unitCount;
            if (avgApartmentArea < 20) {
              errors.push(
                "–°–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∞—è —Å—Ä–µ–¥–Ω—è—è –ø–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä—ã (–º–µ–Ω–µ–µ 20 –º¬≤)"
              );
            } else if (avgApartmentArea > 200) {
              warnings.push(
                "–û—á–µ–Ω—å –±–æ–ª—å—à–∞—è —Å—Ä–µ–¥–Ω—è—è –ø–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä—ã (–±–æ–ª–µ–µ 200 –º¬≤)"
              );
            }
          }

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–æ—â–∞–¥–µ–π —É—á–∞—Å—Ç–∫–∞
          if (data.landArea > 0) {
            const totalTerrainArea =
              data.roofArea + data.lawnArea + data.hardscapeArea;
            if (totalTerrainArea > data.landArea * 1.1) {
              errors.push("–°—É–º–º–∞ –ø–ª–æ—â–∞–¥–µ–π –ø–æ–∫—Ä—ã—Ç–∏–π –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–ª–æ—â–∞–¥—å —É—á–∞—Å—Ç–∫–∞");
            }
          }

          return { errors, warnings };
        }
      }

      // –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –º–æ–¥—É–ª—å —Ä–∞—Å—á–µ—Ç–∞ —ç–ª–µ–∫—Ç—Ä–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º
      function calculateElectricity(data) {
        const {
          totalArea,
          residentialArea,
          unitCount,
          hasGas,
          objectClass,
          hasParking,
        } = data;

        let totalLoad = 0;
        let baseArea = 0;
        let method = "";
        let useHybrid = false;

        try {
          // –ì–ò–ë–†–ò–î–ù–´–ô –†–ê–°–ß–ï–¢ - –µ—Å–ª–∏ –µ—Å—Ç—å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä, –∏ –ø–ª–æ—â–∞–¥—å
          if (
            unitCount > 0 &&
            hasGas !== "" &&
            (residentialArea > 0 || totalArea > 0)
          ) {
            useHybrid = true;

            // –†–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–π –ø–ª–æ—â–∞–¥–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã
            const workingResidentialArea =
              residentialArea ||
              totalArea * CONSTANTS.DEFAULT_RESIDENTIAL_RATIO;
            const avgApartmentArea = workingResidentialArea / unitCount;

            // –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ —Ç–∞–±–ª–∏—Ü–µ –°–ü
            const hasGasBool = hasGas === "true";
            const specificLoadTable = getSpecificLoad(unitCount, hasGasBool);

            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –ø–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä
            let areaCorrection = 1.0;
            if (avgApartmentArea > CONSTANTS.LARGE_APARTMENT_THRESHOLD) {
              // –î–ª—è –±–æ–ª—å—à–∏—Ö –∫–≤–∞—Ä—Ç–∏—Ä –ø—Ä–∏–º–µ–Ω—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—é
              areaCorrection =
                avgApartmentArea / CONSTANTS.STANDARD_APARTMENT_AREA;
              // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
              areaCorrection = Math.min(areaCorrection, 3.0);
            }

            // –†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏
            const apartmentLoad =
              specificLoadTable * unitCount * areaCorrection;
            const mopLoad = apartmentLoad * 0.12;
            const detailedLoad = apartmentLoad + mopLoad;

            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —É–∫—Ä—É–ø–Ω–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç
            const isPremium = objectClass === "–ë–∏–∑–Ω–µ—Å/–ü—Ä–µ–º–∏—É–º";
            let alternativeLoad = 0;

            if (totalArea > 0) {
              let baseCoeff = isPremium
                ? CONSTANTS.ELEC_LOAD_FACTOR_PREMIUM
                : CONSTANTS.ELEC_LOAD_FACTOR_STD;
              alternativeLoad = totalArea * baseCoeff;
            } else {
              let baseCoeff = isPremium
                ? CONSTANTS.ELEC_LOAD_FACTOR_RESIDENTIAL_PREMIUM
                : CONSTANTS.ELEC_LOAD_FACTOR_RESIDENTIAL_STD;
              alternativeLoad = workingResidentialArea * baseCoeff;
            }

            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Ç–∏–ø –ø–ª–∏—Ç –¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
            if (hasGas === "false") {
              alternativeLoad *= CONSTANTS.ELEC_COOKING_MULTIPLIER;
            }

            // –í—ã–±–∏—Ä–∞–µ–º –±–æ–ª—å—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            totalLoad = Math.max(detailedLoad, alternativeLoad);
            baseArea = totalArea || workingResidentialArea;

            method = `–ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–∞—Å—á–µ—Ç: ${unitCount} –∫–≤. (—Å—Ä. ${Math.round(
              avgApartmentArea
            )} –º¬≤/–∫–≤.), ${hasGasBool ? "–≥–∞–∑–æ–≤—ã–µ" : "—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ"} –ø–ª–∏—Ç—ã`;
            if (areaCorrection > 1.1) {
              method += `, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –ø–ª–æ—â–∞–¥—å √ó${areaCorrection.toFixed(
                2
              )}`;
            }
            if (totalLoad === alternativeLoad) {
              method += ` (–≤—ã–±—Ä–∞–Ω —É–∫—Ä—É–ø–Ω–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥)`;
            }
          } else if (unitCount > 0 && hasGas !== "") {
            // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç (–±–µ–∑ –ø–ª–æ—â–∞–¥–∏)
            const hasGasBool = hasGas === "true";
            const specificLoad = getSpecificLoad(unitCount, hasGasBool);

            const apartmentLoad = specificLoad * unitCount;
            const mopLoad = apartmentLoad * 0.12;
            totalLoad = apartmentLoad + mopLoad;

            baseArea =
              totalArea ||
              residentialArea ||
              unitCount * CONSTANTS.TYPICAL_APARTMENT_AREA;
            method = `–î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç: ${unitCount} –∫–≤., ${
              hasGasBool ? "–≥–∞–∑–æ–≤—ã–µ" : "—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ"
            } –ø–ª–∏—Ç—ã`;
          } else {
            // –£–∫—Ä—É–ø–Ω–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –ø–ª–æ—â–∞–¥–∏
            const isPremium = objectClass === "–ë–∏–∑–Ω–µ—Å/–ü—Ä–µ–º–∏—É–º";

            if (totalArea > 0) {
              const baseCoeff = isPremium
                ? CONSTANTS.ELEC_LOAD_FACTOR_PREMIUM
                : CONSTANTS.ELEC_LOAD_FACTOR_STD;
              totalLoad = totalArea * baseCoeff;
              baseArea = totalArea;
              method = `–£–∫—Ä—É–ø–Ω–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –æ–±—â–µ–π –ø–ª–æ—â–∞–¥–∏ (${totalArea} –º¬≤)`;
            } else if (residentialArea > 0) {
              const baseCoeff = isPremium
                ? CONSTANTS.ELEC_LOAD_FACTOR_RESIDENTIAL_PREMIUM
                : CONSTANTS.ELEC_LOAD_FACTOR_RESIDENTIAL_STD;
              totalLoad = residentialArea * baseCoeff;
              baseArea = residentialArea;
              method = `–£–∫—Ä—É–ø–Ω–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ –∂–∏–ª–æ–π –ø–ª–æ—â–∞–¥–∏ (${residentialArea} –º¬≤)`;
            } else {
              return null;
            }

            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Ç–∏–ø –ø–ª–∏—Ç
            if (hasGas === "false") {
              totalLoad *= CONSTANTS.ELEC_COOKING_MULTIPLIER;
              method += ", —ç–ª–µ–∫—Ç—Ä–æ–ø–ª–∏—Ç—ã (+15%)";
            }

            method += `, ${objectClass}`;
          }

          // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä–∫–∏–Ω–≥–∞
          if (hasParking === "true") {
            let parkingLoad = 0;
            let parkingMethod = "";

            // –ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ô –†–ê–°–ß–ï–¢: –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–≤–∞—Ä—Ç–∏—Ä
            if (unitCount > 0) {
              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–±—ä–µ–∫—Ç –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–º
              const isPremium = objectClass === "–ë–∏–∑–Ω–µ—Å/–ü—Ä–µ–º–∏—É–º";

              // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –Ω–æ—Ä–º–∞—Ç–∏–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–ª–∞—Å—Å–∞
              const spacesPerUnitNorm = isPremium
                ? CONSTANTS.NORM_SPACES_PER_UNIT_PREMIUM
                : CONSTANTS.NORM_SPACES_PER_UNIT_STD;

              const estimatedSpaces = unitCount * spacesPerUnitNorm;
              const estimatedParkingArea =
                estimatedSpaces * CONSTANTS.NORM_AREA_PER_SPACE;
              parkingLoad = estimatedParkingArea * CONSTANTS.ELEC_LOAD_PARKING;

              // –í —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–º –Ω–æ—Ä–º–∞—Ç–∏–≤–µ
              parkingMethod = `, +–ø–∞—Ä–∫–∏–Ω–≥ (~${Math.round(
                estimatedSpaces
              )} –º/–º –ø–æ –Ω–æ—Ä–º–∞—Ç–∏–≤—É –¥–ª—è '${
                isPremium ? "–ë–∏–∑–Ω–µ—Å/–ü—Ä–µ–º–∏—É–º" : "–°—Ç–∞–Ω–¥–∞—Ä—Ç"
              }', ${Math.round(parkingLoad)} –∫–í—Ç)`;
            }
            // –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ô –†–ê–°–ß–ï–¢ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
            else if (residentialArea > 0) {
              const ELEC_LOAD_PARKING_FROM_RESIDENTIAL = 0.015;
              parkingLoad =
                residentialArea * ELEC_LOAD_PARKING_FROM_RESIDENTIAL;
              parkingMethod = `, +–ø–∞—Ä–∫–∏–Ω–≥ (~${Math.round(
                parkingLoad
              )} –∫–í—Ç, –ø–æ –Ω–æ—Ä–º–∞—Ç–∏–≤—É –æ—Ç –∂–∏–ª–æ–π –ø–ª–æ—â–∞–¥–∏)`;
            }

            if (parkingLoad > 0) {
              totalLoad += parkingLoad;
              method += parkingMethod;
            }
          }

          return {
            P_calc: Math.round(totalLoad),
            category: baseArea > 150 ? "II –∫–∞—Ç–µ–≥–æ—Ä–∏—è" : "III –∫–∞—Ç–µ–≥–æ—Ä–∏—è",
            voltage:
              totalLoad > CONSTANTS.ELEC_THRESHOLD_10KV ? "10 –∫–í" : "0.4 –∫–í",
            requiresTP:
              totalLoad > CONSTANTS.ELEC_THRESHOLD_10KV
                ? "–î–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ 2-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ç–æ—Ä–Ω–æ–π –ö–¢–ü"
                : "–ù–µ—Ç",
            method: method,
            hybrid: useHybrid,
          };
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —ç–ª–µ–∫—Ç—Ä–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è:", error);
          return null;
        }
      }

      // –ú–æ–¥—É–ª—å —Ä–∞—Å—á–µ—Ç–∞ —Ç–µ–ø–ª–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è
      function calculateHeating(data) {
        const { totalArea, residentialArea, objectClass, floorCount } = data;

        try {
          const areaToUse = totalArea > 0 ? totalArea : residentialArea;

          if (areaToUse <= 0) return null;

          let specificLoad =
            objectClass === "–ë–∏–∑–Ω–µ—Å/–ü—Ä–µ–º–∏—É–º"
              ? CONSTANTS.HEAT_LOAD_FACTOR_PREMIUM
              : CONSTANTS.HEAT_LOAD_FACTOR_STD;

          // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ —ç—Ç–∞–∂–Ω–æ—Å—Ç—å
          if (floorCount > 0) {
            if (floorCount > 16) {
              specificLoad *= 1.1;
            } else if (floorCount <= 3) {
              specificLoad *= 0.95;
            }
          }

          const loadKW = (areaToUse * specificLoad) / 1000;
          const loadGcal = loadKW * CONSTANTS.KW_TO_GCAL_H_FACTOR;

          return {
            Q_max: loadGcal.toFixed(4),
            Q_max_kW: Math.round(loadKW),
            method: `–†–∞—Å—á–µ—Ç –ø–æ –ø–ª–æ—â–∞–¥–∏ ${areaToUse} –º¬≤${
              floorCount > 0 ? `, ${floorCount} —ç—Ç.` : ""
            }`,
          };
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ç–µ–ø–ª–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è:", error);
          return null;
        }
      }

      // –ú–æ–¥—É–ª—å —Ä–∞—Å—á–µ—Ç–∞ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è
      function calculateWaterSupply(data) {
        const { residentialArea, unitCount } = data;

        try {
          if (residentialArea <= 0) return null;

          let residents;
          if (unitCount > 0 && residentialArea > 0) {
            const avgApartmentArea = residentialArea / unitCount;
            const personsPerApartment =
              avgApartmentArea < 40 ? 2 : avgApartmentArea < 80 ? 2.5 : 3;
            residents = Math.ceil(unitCount * personsPerApartment);
          } else {
            residents = Math.ceil(
              residentialArea / CONSTANTS.AREA_PER_PERSON_STD
            );
          }

          const dailyConsumption =
            (residents * CONSTANTS.WATER_NORM_DAY) / 1000;
          const hourlyConsumption =
            (residents * CONSTANTS.WATER_NORM_HOUR) / 1000;
          const secondConsumption =
            CONSTANTS.WATER_NORM_SECOND_Q0 *
            CONSTANTS.WATER_ALPHA_COEFF *
            Math.sqrt(residents);

          return {
            Q_day: dailyConsumption.toFixed(2),
            q_hour_max: hourlyConsumption.toFixed(3),
            q_sec_max: secondConsumption.toFixed(2),
            residents: residents,
            method: `–†–∞—Å—á–µ—Ç –Ω–∞ ${residents} –∂–∏—Ç–µ–ª–µ–π`,
          };
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è:", error);
          return null;
        }
      }

      // –ú–æ–¥—É–ª—å —Ä–∞—Å—á–µ—Ç–∞ –¥–æ–∂–¥–µ–≤–æ–π –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
      function calculateStormwater(data) {
        const { landArea, roofArea, lawnArea, hardscapeArea } = data;

        try {
          if (!landArea || landArea <= 0) return null;

          let actualRoofArea = roofArea || 0;
          let actualLawnArea = lawnArea || 0;
          let actualHardscapeArea = hardscapeArea || 0;

          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
          if (
            actualRoofArea === 0 &&
            actualLawnArea === 0 &&
            actualHardscapeArea === 0
          ) {
            actualRoofArea = landArea * CONSTANTS.NORM_BUILDING_RATIO;
            actualLawnArea = landArea * CONSTANTS.NORM_LAWN_RATIO;
            actualHardscapeArea = landArea * CONSTANTS.NORM_HARDSCAPE_RATIO;
          } else {
            const totalSpecified =
              actualRoofArea + actualLawnArea + actualHardscapeArea;
            const remaining = landArea - totalSpecified;

            if (remaining > 0) {
              if (actualLawnArea === 0) actualLawnArea = remaining * 0.6;
              if (actualHardscapeArea === 0)
                actualHardscapeArea = remaining * 0.4;
            }
          }

          const totalArea =
            actualRoofArea + actualLawnArea + actualHardscapeArea;
          if (totalArea > landArea * 1.1) {
            throw new Error(
              "–°—É–º–º–∞ –ø–ª–æ—â–∞–¥–µ–π –ø–æ–∫—Ä—ã—Ç–∏–π –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–ª–æ—â–∞–¥—å —É—á–∞—Å—Ç–∫–∞"
            );
          }

          const F = landArea / 10000;
          const z_mid =
            (actualRoofArea * CONSTANTS.COEFF_ROOF +
              actualHardscapeArea * CONSTANTS.COEFF_ASPHALT +
              actualLawnArea * CONSTANTS.COEFF_LAWN) /
            landArea;

          const A =
            CONSTANTS.Q20_MOSCOW * Math.pow(20, CONSTANTS.STORM_PARAM_N_MOSCOW);
          const t_r = 15;
          const Q_rain_max =
            (A * z_mid * F) / Math.pow(t_r, CONSTANTS.STORM_PARAM_N_MOSCOW);

          return {
            Q_rain_max: Q_rain_max.toFixed(2),
            z_mid: z_mid.toFixed(3),
            method: `–†–∞—Å—á–µ—Ç: –∫—Ä–æ–≤–ª—è ${actualRoofArea.toFixed(
              0
            )} –º¬≤, –≥–∞–∑–æ–Ω—ã ${actualLawnArea.toFixed(
              0
            )} –º¬≤, –ø–æ–∫—Ä—ã—Ç–∏—è ${actualHardscapeArea.toFixed(0)} –º¬≤`,
          };
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –¥–æ–∂–¥–µ–≤–æ–π –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏:", error);
          return null;
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞
      const validator = new DataValidator();

      // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–ª—è
      function validateField(fieldId) {
        const field = document.getElementById(fieldId);
        const validation = validator.validateField(fieldId, field.value);
        const messageDiv = document.getElementById(`${fieldId}-validation`);

        field.classList.remove("input-error", "input-warning");
        messageDiv.style.display = "none";
        messageDiv.className = "validation-message";

        if (!validation.valid) {
          field.classList.add("input-error");
          messageDiv.className = "validation-message validation-error";
          messageDiv.textContent = validation.message;
          messageDiv.style.display = "block";
        } else if (validation.type === "warning") {
          field.classList.add("input-warning");
          messageDiv.className = "validation-message validation-warning";
          messageDiv.textContent = validation.message;
          messageDiv.style.display = "block";
        }

        return validation.valid;
      }

      // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–¥–µ–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
      function getSpecificLoad(unitCount, hasGas) {
        const table = hasGas ? ELEC_LOAD_TABLE.gas : ELEC_LOAD_TABLE.electric;
        const keys = Object.keys(table)
          .map(Number)
          .sort((a, b) => a - b);

        for (let i = 0; i < keys.length; i++) {
          if (unitCount <= keys[i]) {
            return table[keys[i]];
          }
        }
        return table[keys[keys.length - 1]];
      }

      // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
      function autoFillTerrain() {
        const landArea =
          parseFloat(document.getElementById("landArea").value) || 0;
        const totalArea =
          parseFloat(document.getElementById("totalArea").value) || 0;
        const floorCount =
          parseInt(document.getElementById("floorCount").value) || 0;

        if (landArea <= 0) {
          alert("–°–Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏—Ç–µ –ø–ª–æ—â–∞–¥—å –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞");
          return;
        }

        // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–ª–æ—â–∞–¥–∏ –∫—Ä–æ–≤–ª–∏
        // –ù–æ–≤–∞—è, –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞:
        let roofArea;
        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ1: –†–∞—Å—á–µ—Ç —á–µ—Ä–µ–∑ –ø–ª–æ—â–∞–¥—å –∏ —ç—Ç–∞–∂–Ω–æ—Å—Ç—å (—Å–∞–º—ã–π —Ç–æ—á–Ω—ã–π)
        if (totalArea > 0 && floorCount > 0) {
          roofArea = totalArea / floorCount;
        }
        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ2: –†–∞—Å—á–µ—Ç –æ—Ç –ø–ª–æ—â–∞–¥–∏ —É—á–∞—Å—Ç–∫–∞ –ø–æ –Ω–æ—Ä–º–∞—Ç–∏–≤—É (–Ω–∞–¥–µ–∂–Ω—ã–π)
        else {
          roofArea = landArea * CONSTANTS.NORM_BUILDING_RATIO;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ–±—ã –ø–ª–æ—â–∞–¥—å –∫—Ä–æ–≤–ª–∏ –Ω–µ –±—ã–ª–∞ –±–æ–ª—å—à–µ –ø–ª–æ—â–∞–¥–∏ —É—á–∞—Å—Ç–∫–∞
        if (roofArea > landArea) {
          roofArea = landArea * CONSTANTS.NORM_BUILDING_RATIO;
        }

        const lawnArea = landArea * CONSTANTS.NORM_LAWN_RATIO;
        const hardscapeArea = landArea * CONSTANTS.NORM_HARDSCAPE_RATIO;

        document.getElementById("roofArea").value = roofArea.toFixed(0);
        document.getElementById("lawnArea").value = lawnArea.toFixed(0);
        document.getElementById("hardscapeArea").value =
          hardscapeArea.toFixed(0);

        ["roofArea", "lawnArea", "hardscapeArea"].forEach(validateField);
      }

      // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
      function generateMessages(results, data) {
        const messages = [];

        if (
          results.electricity &&
          results.electricity.P_calc > CONSTANTS.ELEC_THRESHOLD_10KV
        ) {
          messages.push(
            `–í–ù–ò–ú–ê–ù–ò–ï: –†–∞—Å—á–µ—Ç–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–∞–µ—Ç ${CONSTANTS.ELEC_THRESHOLD_10KV} –∫–í—Ç. –í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ü–ü –†–§ ‚Ññ861 –∏ –ø—Ä–∞–∫—Ç–∏–∫–æ–π –ü–ê–û ¬´–†–æ—Å—Å–µ—Ç–∏¬ª, –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª—É—á–µ–Ω–∏–µ –¢–£ –Ω–∞ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ 10 –∫–í –∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π 2-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ç–æ—Ä–Ω–æ–π –ø–æ–¥—Å—Ç–∞–Ω—Ü–∏–∏ (–ö–¢–ü) –Ω–∞ –∑–µ–º–µ–ª—å–Ω–æ–º —É—á–∞—Å—Ç–∫–µ. –≠—Ç–æ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –±—é–¥–∂–µ—Ç –∏ —Å—Ä–æ–∫–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.`
          );
        }

        if (data.landArea > 5000) {
          messages.push(
            `–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø: –î–ª—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π —Å–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π –ø–ª–æ—â–∞–¥—å—é –≤–æ–¥–æ—Å–±–æ—Ä–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≥. –ú–æ—Å–∫–≤—ã –¥–µ–ª–∞—é—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫—É –õ–æ–∫–∞–ª—å–Ω—ã—Ö –û—á–∏—Å—Ç–Ω—ã—Ö –°–æ–æ—Ä—É–∂–µ–Ω–∏–π (–õ–û–°) –Ω–∞ –≤—ã–ø—É—Å–∫–µ –¥–æ–∂–¥–µ–≤–æ–π –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Å–±—Ä–æ—Å–æ–º –≤ –≥–æ—Ä–æ–¥—Å–∫—É—é —Å–µ—Ç—å –ì–£–ü ¬´–ú–æ—Å–≤–æ–¥–æ—Å—Ç–æ–∫¬ª. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –≥–µ–Ω–ø–ª–∞–Ω–µ –º–µ—Å—Ç–æ –¥–ª—è –∏—Ö —Ä–∞–∑–º–µ—â–µ–Ω–∏—è.`
          );
        }

        if (results.heating && results.heating.Q_max > 0.5) {
          messages.push(
            `–ò–ù–§–û–†–ú–ê–¶–ò–Ø: –¢–µ–ø–ª–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ${results.heating.Q_max} –ì–∫–∞–ª/—á. –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ç—è–º –ü–ê–û ¬´–ú–û–≠–ö¬ª –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —Ç–µ–ø–ª–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é (–æ—Ç–æ–ø–ª–µ–Ω–∏–µ, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è, –ì–í–°).`
          );
        }

        if (data.floorCount > 16) {
          messages.push(
            `–í–´–°–û–¢–ù–û–ï –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–û: –ü—Ä–∏ —ç—Ç–∞–∂–Ω–æ—Å—Ç–∏ –±–æ–ª–µ–µ 16 —ç—Ç–∞–∂–µ–π —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Å –ú–ß–° –†–æ—Å—Å–∏–∏ –∏ –ø–æ–≤—ã—à–µ–Ω–Ω—ã–µ –Ω–æ—Ä–º–∞—Ç–∏–≤—ã –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑–µ—Ä–≤ –º–æ—â–Ω–æ—Å—Ç–µ–π –Ω–∞ 15-20%.`
          );
        }

        if (results.water && results.water.residents > 1000) {
          messages.push(
            `–ö–†–£–ü–ù–´–ô –ñ–ò–õ–û–ô –ö–û–ú–ü–õ–ï–ö–°: –ü—Ä–∏ —Ä–∞—Å—á–µ—Ç–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∂–∏—Ç–µ–ª–µ–π –±–æ–ª–µ–µ 1000 —á–µ–ª–æ–≤–µ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–∏—Ç—å –Ω–æ—Ä–º–∞—Ç–∏–≤—ã –≤–æ–¥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∞–Ω—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–±–æ—Ä–æ–≤ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–æ–¥–æ—Å–±–µ—Ä–µ–≥–∞—é—â–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π.`
          );
        }

        if (results.electricity) {
          messages.push(`–ú–ï–¢–û–î –†–ê–°–ß–ï–¢–ê: ${results.electricity.method}`);

          if (results.electricity.hybrid) {
            messages.push(
              `–ì–ò–ë–†–ò–î–ù–´–ô –†–ê–°–ß–ï–¢: –ü—Ä–∏–º–µ–Ω–µ–Ω —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥, —É—á–∏—Ç—ã–≤–∞—é—â–∏–π –∫–∞–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä, —Ç–∞–∫ –∏ –∏—Ö —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ø–ª–æ—â–∞–¥—å. –î–ª—è –±–æ–ª—å—à–∏—Ö –∫–≤–∞—Ä—Ç–∏—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—â–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç, —É—á–∏—Ç—ã–≤–∞—é—â–∏–π –ø–æ–≤—ã—à–µ–Ω–Ω–æ–µ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ.`
            );
          }
        }

        return messages;
      }

      // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞
      function performCalculation() {
        const data = {
          totalArea:
            parseFloat(document.getElementById("totalArea").value) || 0,
          residentialArea:
            parseFloat(document.getElementById("residentialArea").value) || 0,
          landArea: parseFloat(document.getElementById("landArea").value) || 0,
          objectClass: document.getElementById("objectClass").value,
          floorCount:
            parseInt(document.getElementById("floorCount").value) || 0,
          unitCount: parseInt(document.getElementById("unitCount").value) || 0,
          hasGas: document.getElementById("hasGas").value,
          hasParking: document.getElementById("hasParking").value,
          roofArea: parseFloat(document.getElementById("roofArea").value) || 0,
          lawnArea: parseFloat(document.getElementById("lawnArea").value) || 0,
          hardscapeArea:
            parseFloat(document.getElementById("hardscapeArea").value) || 0,
        };

        const relationshipValidation = validator.validateRelationships(data);
        if (relationshipValidation.errors.length > 0) {
          alert(
            "–û—à–∏–±–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö:\n" + relationshipValidation.errors.join("\n")
          );
          return;
        }

        const results = {
          electricity: calculateElectricity(data),
          heating: calculateHeating(data),
          water: calculateWaterSupply(data),
          stormwater: calculateStormwater(data),
        };

        displayResults(results);

        const messages = generateMessages(results, data);
        const messagesList = document.getElementById("messagesList");
        messagesList.innerHTML = messages
          .map((msg) => `<li>${msg}</li>`)
          .join("");
      }

      // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      function displayResults(results) {
        const resultsContainer = document.getElementById("resultsContainer");
        let html = "";

        // –ü–ê–û ¬´–†–æ—Å—Å–µ—Ç–∏ –ú–æ—Å–∫–æ–≤—Å–∫–∏–π —Ä–µ–≥–∏–æ–Ω¬ª
        html += '<div class="rso-section">';
        html += '<h3 class="rso-header">–ü–ê–û ¬´–†–æ—Å—Å–µ—Ç–∏ –ú–æ—Å–∫–æ–≤—Å–∫–∏–π —Ä–µ–≥–∏–æ–Ω¬ª</h3>';
        html += '<div class="rso-content">';
        html += '<div class="system-group">';
        html += '<div class="system-title">–≠–ª–µ–∫—Ç—Ä–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ (–≠–°)</div>';

        if (results.electricity) {
          html += `<div class="parameter-item">
                    <span class="parameter-name">–†–∞—Å—á–µ—Ç–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å</span>
                    <span class="parameter-value">${results.electricity.P_calc}<span class="parameter-unit">–∫–í—Ç</span></span>
                </div>`;
          html += `<div class="parameter-item">
                    <span class="parameter-name">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏</span>
                    <span class="parameter-value">${results.electricity.category}</span>
                </div>`;
          html += `<div class="parameter-item">
                    <span class="parameter-name">–£—Ä–æ–≤–µ–Ω—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è</span>
                    <span class="parameter-value">${results.electricity.voltage}</span>
                </div>`;
          html += `<div class="parameter-item">
                    <span class="parameter-name">–¢—Ä–µ–±—É–µ—Ç—Å—è –¢–ü</span>
                    <span class="parameter-value">${results.electricity.requiresTP}</span>
                </div>`;
        } else {
          html +=
            '<div class="parameter-item"><span class="insufficient-data">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</span></div>';
        }

        html += "</div></div></div>";

        // –ü–ê–û ¬´–ú–û–≠–ö¬ª
        html += '<div class="rso-section">';
        html += '<h3 class="rso-header">–ü–ê–û ¬´–ú–û–≠–ö¬ª</h3>';
        html += '<div class="rso-content">';
        html += '<div class="system-group">';
        html += '<div class="system-title">–¢–µ–ø–ª–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ (–¢–°)</div>';

        if (results.heating) {
          html += `<div class="parameter-item">
                    <span class="parameter-name">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–ø–ª–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</span>
                    <span class="parameter-value">${results.heating.Q_max}<span class="parameter-unit">–ì–∫–∞–ª/—á</span></span>
                </div>`;
          html += `<div class="parameter-item">
                    <span class="parameter-name">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–ø–ª–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</span>
                    <span class="parameter-value">${results.heating.Q_max_kW}<span class="parameter-unit">–∫–í—Ç</span></span>
                </div>`;
        } else {
          html +=
            '<div class="parameter-item"><span class="insufficient-data">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</span></div>';
        }

        html += "</div></div></div>";

        // –ê–û ¬´–ú–æ—Å–≤–æ–¥–æ–∫–∞–Ω–∞–ª¬ª
        html += '<div class="rso-section">';
        html += '<h3 class="rso-header">–ê–û ¬´–ú–æ—Å–≤–æ–¥–æ–∫–∞–Ω–∞–ª¬ª</h3>';
        html += '<div class="rso-content">';

        // –í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ
        html += '<div class="system-group">';
        html += '<div class="system-title">–í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ (–í1)</div>';

        if (results.water) {
          html += `<div class="parameter-item">
                    <span class="parameter-name">–°—Ä–µ–¥–Ω–µ—Å—É—Ç–æ—á–Ω—ã–π —Ä–∞—Å—Ö–æ–¥</span>
                    <span class="parameter-value">${results.water.Q_day}<span class="parameter-unit">–º¬≥/—Å—É—Ç</span></span>
                </div>`;
          html += `<div class="parameter-item">
                    <span class="parameter-name">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —á–∞—Å–æ–≤–æ–π —Ä–∞—Å—Ö–æ–¥</span>
                    <span class="parameter-value">${results.water.q_hour_max}<span class="parameter-unit">–º¬≥/—á</span></span>
                </div>`;
          html += `<div class="parameter-item">
                    <span class="parameter-name">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å–µ–∫—É–Ω–¥–Ω—ã–π —Ä–∞—Å—Ö–æ–¥</span>
                    <span class="parameter-value">${results.water.q_sec_max}<span class="parameter-unit">–ª/—Å</span></span>
                </div>`;
        } else {
          html +=
            '<div class="parameter-item"><span class="insufficient-data">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</span></div>';
        }

        html += "</div>";

        // –ë—ã—Ç–æ–≤–∞—è –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è
        html += '<div class="system-group">';
        html += '<div class="system-title">–ë—ã—Ç–æ–≤–∞—è –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è (–ö1)</div>';

        if (results.water) {
          html += `<div class="parameter-item">
                    <span class="parameter-name">–°—Ä–µ–¥–Ω–µ—Å—É—Ç–æ—á–Ω—ã–π —Ä–∞—Å—Ö–æ–¥</span>
                    <span class="parameter-value">${results.water.Q_day}<span class="parameter-unit">–º¬≥/—Å—É—Ç</span></span>
                </div>`;
          html += `<div class="parameter-item">
                    <span class="parameter-name">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —á–∞—Å–æ–≤–æ–π —Ä–∞—Å—Ö–æ–¥</span>
                    <span class="parameter-value">${results.water.q_hour_max}<span class="parameter-unit">–º¬≥/—á</span></span>
                </div>`;
          html += `<div class="parameter-item">
                    <span class="parameter-name">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å–µ–∫—É–Ω–¥–Ω—ã–π —Ä–∞—Å—Ö–æ–¥</span>
                    <span class="parameter-value">${results.water.q_sec_max}<span class="parameter-unit">–ª/—Å</span></span>
                </div>`;
        } else {
          html +=
            '<div class="parameter-item"><span class="insufficient-data">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</span></div>';
        }

        html += "</div></div></div>";

        // –ì–£–ü ¬´–ú–æ—Å–≤–æ–¥–æ—Å—Ç–æ–∫¬ª
        html += '<div class="rso-section">';
        html += '<h3 class="rso-header">–ì–£–ü ¬´–ú–æ—Å–≤–æ–¥–æ—Å—Ç–æ–∫¬ª</h3>';
        html += '<div class="rso-content">';
        html += '<div class="system-group">';
        html += '<div class="system-title">–î–æ–∂–¥–µ–≤–∞—è –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è (–ö2)</div>';

        if (results.stormwater) {
          html += `<div class="parameter-item">
                    <span class="parameter-name">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ –¥–æ–∂–¥–µ–≤—ã—Ö –≤–æ–¥</span>
                    <span class="parameter-value">${results.stormwater.Q_rain_max}<span class="parameter-unit">–ª/—Å</span></span>
                </div>`;
          html += `<div class="parameter-item">
                    <span class="parameter-name">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å—Ç–æ–∫–∞</span>
                    <span class="parameter-value">${results.stormwater.z_mid}</span>
                </div>`;
        } else {
          html +=
            '<div class="parameter-item"><span class="insufficient-data">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</span></div>';
        }

        html += "</div></div></div>";

        resultsContainer.innerHTML = html;
        document.getElementById("results").style.display = "block";
      }

      // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã
      function validateForm() {
        const fieldIds = [
          "totalArea",
          "residentialArea",
          "landArea",
          "floorCount",
          "unitCount",
          "roofArea",
          "lawnArea",
          "hardscapeArea",
        ];
        let isValid = true;

        fieldIds.forEach((fieldId) => {
          if (!validateField(fieldId)) {
            isValid = false;
          }
        });

        const calculateBtn = document.getElementById("calculateBtn");
        calculateBtn.disabled = !isValid;

        return isValid;
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      document.addEventListener("DOMContentLoaded", function () {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Ç–µ–º
        const themeManager = new ThemeManager();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        validateForm();

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document
          .getElementById("calculationForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            if (validateForm()) {
              performCalculation();
            }
          });

        document
          .getElementById("autoFillTerrain")
          .addEventListener("click", autoFillTerrain);

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        const fieldIds = [
          "totalArea",
          "residentialArea",
          "landArea",
          "floorCount",
          "unitCount",
          "roofArea",
          "lawnArea",
          "hardscapeArea",
        ];

        fieldIds.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          field.addEventListener("input", function () {
            validateField(fieldId);
            setTimeout(validateForm, 100);
          });
        });
      });
    </script>
  </body>
</html>
